<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Card√°pio DokaBurger</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css "/>
    <style>
        :root {
            --laranja: #FF6B00;
            --marrom: #2E1A0F;
            --branco: #FFFFFF;
            --cinza: #F5F5F5;
            --verde: #25D366;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        body {
            background-color: var(--cinza);
            color: var(--marrom);
            padding-bottom: 80px;
        }
        header {
            background: var(--marrom);
            color: var(--branco);
            padding: 15px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        .logo {
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .logo span {
            color: var(--laranja);
        }
        .logo i {
            margin-right: 10px;
            color: var(--laranja);
        }
        .menu-container {
            display: flex;
            align-items: center;
            background: var(--branco);
            position: sticky;
            top: 60px;
            z-index: 90;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .menu-nav-btn {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--laranja);
            cursor: pointer;
            padding: 0 10px;
        }
        .menu-categorias {
            flex-grow: 1;
            display: flex;
            overflow-x: auto;
            scroll-behavior: smooth;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .menu-categorias::-webkit-scrollbar {
            display: none;
        }
        .categoria-btn {
            padding: 12px 15px;
            margin: 8px 5px;
            background: var(--cinza);
            border: none;
            border-radius: 20px;
            font-weight: bold;
            white-space: nowrap;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        .categoria-btn.ativo {
            background: var(--laranja);
            color: var(--branco);
        }
        .produtos-container {
            padding: 15px;
        }
        .produto-card {
            background: var(--branco);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            display: flex;
        }
        .produto-imagem-container {
            width: 120px;
            height: 120px;
            min-width: 120px;
        }
        .produto-imagem {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .produto-conteudo {
            padding: 15px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        .produto-nome {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .produto-badge {
            background: var(--laranja);
            color: white;
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 12px;
            margin-left: 10px;
            white-space: nowrap;
        }
        .produto-descricao {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
            flex-grow: 1;
        }
        .produto-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .produto-preco-container {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .produto-preco {
            font-size: 18px;
            font-weight: bold;
            color: var(--laranja);
        }
        .produto-preco-antigo {
            font-size: 12px;
            color: #999;
            text-decoration: line-through;
        }
        .add-btn {
            background: var(--laranja);
            color: var(--branco);
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .carrinho-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--laranja);
            color: var(--branco);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.3);
            cursor: pointer;
            z-index: 80;
            border: none;
        }
        .carrinho-contador {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--marrom);
            color: var(--branco);
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            z-index: 999;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.3);
            animation: modalFadeIn 0.3s;
            display: flex;
            flex-direction: column;
            max-height: 80vh;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        #carrinho-itens {
            overflow-y: auto;
            flex-grow: 1;
            padding-right: 10px;
        }
        .carrinho-item {
            display: flex;
            flex-direction: column;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        .carrinho-item-header {
            display: flex;
            align-items: center;
            width: 100%;
        }
        .carrinho-item-info {
            flex-grow: 1;
        }
        .carrinho-item-info p {
            font-size: 14px;
            color: #666;
        }
        .quantidade-controls {
            display: flex;
            align-items: center;
            margin: 0 10px;
        }
        .quantidade-controls button {
            background: var(--cinza);
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            font-weight: bold;
            cursor: pointer;
        }
        .quantidade-controls span {
            margin: 0 12px;
            font-size: 16px;
        }
        .remover-item-btn {
            background: none;
            border: none;
            color: #ff4d4d;
            font-size: 18px;
            cursor: pointer;
            margin-left: 10px;
        }
        .carrinho-item-obs {
            margin-top: 10px;
        }
        .obs-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #eee;
            border-radius: 5px;
            font-size: 14px;
            background-color: #fafafa;
        }
        .obs-input::placeholder {
            color: #999;
        }
        .carrinho-footer {
            margin-top: 20px;
            border-top: 1px solid #ddd;
            padding-top: 15px;
        }
        .carrinho-resumo {
            font-size: 16px;
        }
        .carrinho-resumo div {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            color: #555;
        }
        .carrinho-resumo div span:first-child {
            color: #555;
        }
        .carrinho-total {
            display: flex;
            justify-content: space-between;
            font-size: 18px;
            font-weight: bold;
            margin-top: 10px;
        }
        .carrinho-actions button {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
        }
        #btn-finalizar-pedido {
            background: var(--laranja);
            color: var(--branco);
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        .form-group input:read-only {
            background-color: var(--cinza);
        }
        .form-actions {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
        }
        .btn-primary {
            background: var(--laranja);
            color: var(--branco);
            margin-bottom: 8px;
            padding: 12px;
            border-radius: 8px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
        }
        .btn-secondary {
            background: var(--cinza);
            color: var(--marrom);
            padding: 12px;
            border-radius: 8px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
        }
        #dados-confirmacao p {
            margin-bottom: 10px;
            background-color: #fafafa;
            padding: 10px;
            border-radius: 5px;
            text-align: left;
        }
        #dados-confirmacao p strong {
            color: var(--marrom);
        }
        .metodo-pagamento {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .metodo-pagamento:hover,
        .metodo-pagamento.ativo {
            border-color: var(--laranja);
            background-color: #FFF3E0;
        }
        .metodo-pagamento i {
            font-size: 24px;
            margin-right: 15px;
            width: 30px;
            text-align: center;
        }
        .troco-container {
            margin-top: 10px;
            display: none;
        }
        .troco-calculado {
            background-color: #FFF9E6;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            display: none;
        }
        .confirmacao-content {
            text-align: center;
        }
        .confirmacao-content h2 {
            font-size: 28px;
            color: var(--marrom);
            margin-bottom: 15px;
        }
        .confirmacao-content p {
            margin: 15px 0;
            font-size: 16px;
            color: #333;
        }
        .codigo-entrega-container {
            margin: 20px 0;
        }
        .codigo-entrega-label {
            font-size: 14px;
            text-transform: uppercase;
            color: #555;
            margin-bottom: 5px;
        }
        .codigo-entrega {
            font-size: 32px;
            font-weight: bold;
            color: var(--laranja);
            padding: 15px;
            border: 2px dashed var(--laranja);
            border-radius: 8px;
            background-color: #FFF3E0;
            letter-spacing: 5px;
            display: inline-block;
            margin-top: 5px;
        }
        .emoji-header {
            font-size: 60px;
            margin-bottom: 20px;
            line-height: 1;
        }
        .info-box {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: left;
        }
        .success-box {
            background-color: #FFF3E0;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }

        /* Responsividade para o modal de confirma√ß√£o */
        @media (max-width: 500px) {
            .modal-content.confirmacao-content {
                padding: 10px;
            }
            .confirmacao-content {
                padding: 10px;
            }
            .codigo-entrega {
                font-size: 24px;
                padding: 10px;
            }
            .emoji-header {
                font-size: 40px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <i class="fas fa-hamburger"></i>
            Doka<span>Burger</span>
        </div>
    </header>
    <div class="menu-container">
        <button id="btn-scroll-left" class="menu-nav-btn"><i class="fas fa-chevron-left"></i></button>
        <div class="menu-categorias">
            <button class="categoria-btn ativo" data-categoria="Burgers 180g">Burgers 180g</button>
            <button class="categoria-btn" data-categoria="Burgers 120g">Burgers 120g</button>
            <button class="categoria-btn" data-categoria="Frango">Frango</button>
            <button class="categoria-btn" data-categoria="Combos">Combos</button>
            <button class="categoria-btn" data-categoria="Bebidas">Bebidas</button>
        </div>
        <button id="btn-scroll-right" class="menu-nav-btn"><i class="fas fa-chevron-right"></i></button>
    </div>
    <div class="produtos-container"></div>
    <button class="carrinho-btn">
        <i class="fas fa-shopping-cart"></i>
        <div class="carrinho-contador">0</div>
    </button>

    <!-- Modal Carrinho -->
    <div id="modalCarrinho" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Meu Carrinho</h2>
                <button onclick="fecharModalCarrinho()" style="background:none; border:none; font-size: 24px; cursor:pointer;">&times;</button>
            </div>
            <div id="carrinho-itens"></div>
            <div class="carrinho-footer">
                <div class="carrinho-resumo">
                    <div><span>Subtotal</span><span id="carrinho-subtotal">R$ 0,00</span></div>
                    <div><span>Taxa de Entrega</span><span id="carrinho-taxa-entrega">R$ 5,00</span></div>
                </div>
                <div class="carrinho-total"><span>Total</span><span id="carrinho-total-valor">R$ 0,00</span></div>
                <div class="carrinho-actions">
                    <button id="btn-finalizar-pedido">Finalizar Pedido</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Login -->
    <div id="modalLogin" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2>Identifica√ß√£o</h2></div>
            <div class="form-group">
                <label for="input-telefone">Seu WhatsApp (apenas n√∫meros)</label>
                <input type="tel" id="input-telefone" placeholder="11999999999" maxlength="11">
                <small style="color: #666;">Digite 10 ou 11 n√∫meros: DDD + Telefone.</small>
            </div>
            <div class="form-actions">
                <button id="btn-continuar-login" class="btn-primary">Continuar</button>
                <button onclick="fecharModalLogin()" class="btn-secondary">Voltar ao Carrinho</button>
            </div>
        </div>
    </div>

    <!-- Modal Confirmar Dados -->
    <div id="modalConfirmarDados" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2>Confirme seus Dados</h2></div>
            <p>Ol√° de novo! Encontramos seu cadastro. Os dados abaixo est√£o corretos?</p>
            <div id="dados-confirmacao"></div>
            <div class="form-actions">
                <button id="btn-dados-corretos" class="btn-primary">Sim, est√£o corretos!</button>
                <button id="btn-editar-dados" class="btn-secondary">N√£o, quero editar</button>
            </div>
        </div>
    </div>

    <!-- Modal Endere√ßo -->
    <div id="modalEndereco" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2>Onde ser√° a entrega?</h2></div>
            <p style="margin-bottom: 15px; font-size: 14px; color: #666;">
                Como √© sua primeira vez (ou voc√™ pediu para editar), precisamos do seu endere√ßo.
            </p>
            <div class="form-group">
                <label>Contato (WhatsApp)</label>
                <input type="tel" id="input-contato-endereco" readonly>
            </div>
            <div class="form-group">
                <label for="input-nome">Nome Completo</label>
                <input type="text" id="input-nome" placeholder="Seu nome completo">
            </div>
            <div class="form-group">
                <label for="input-endereco">Endere√ßo Completo</label>
                <input type="text" id="input-endereco" placeholder="Rua, N√∫mero, Bairro">
            </div>
            <div class="form-group">
                <label for="input-referencia">Ponto de Refer√™ncia (Opcional)</label>
                <input type="text" id="input-referencia" placeholder="Ex: Pr√≥ximo ao mercado">
            </div>
            <div class="form-actions">
                <button id="btn-salvar-endereco" class="btn-primary">Salvar e Ir para Pagamento</button>
            </div>
        </div>
    </div>

    <!-- Modal Pagamento -->
    <div id="modalPagamento" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2>üí∞ Forma de Pagamento</h2></div>
            <div class="metodo-pagamento" data-metodo="Dinheiro">
                <i class="fas fa-money-bill-wave"></i>
                <div>
                    <strong>Dinheiro</strong>
                    <p style="font-size: 12px; color: #666;">Pagamento na entrega</p>
                </div>
            </div>
            <div class="troco-container">
                <div style="margin-bottom: 15px; display: flex; align-items: center;">
                    <i class="fas fa-exchange-alt" style="font-size: 20px; margin-right: 10px; color: var(--laranja);"></i>
                    <div style="flex-grow: 1;">
                        <label for="troco-input" style="display: block; margin-bottom: 5px; font-weight: bold;">Precisa de troco para quanto?</label>
                        <div style="display: flex; align-items: center;">
                            <span style="margin-right: 5px; font-weight: bold;">R$</span>
                            <input type="number" id="troco-input" class="form-group"
                                   placeholder="Ex: 50,00" step="0.01" min="0"
                                   style="flex-grow: 1; margin-bottom: 0;">
                        </div>
                        <small style="color: #666; display: block; margin-top: 5px;">
                            Deixe em branco se n√£o precisar de troco
                        </small>
                    </div>
                </div>
                <div class="troco-calculado" id="troco-calculado">
                    <i class="fas fa-calculator" style="margin-right: 5px;"></i>
                    <span id="valor-troco-texto"></span>
                </div>
            </div>
            <div class="metodo-pagamento" data-metodo="PIX">
                <i class="fas fa-qrcode"></i>
                <div>
                    <strong>PIX</strong>
                    <p style="font-size: 12px; color: #666;">Chave na entrega</p>
                </div>
            </div>
            <div class="metodo-pagamento" data-metodo="Cart√£o">
                <i class="fas fa-credit-card"></i>
                <div>
                    <strong>Cart√£o</strong>
                    <p style="font-size: 12px; color: #666;">Maquininha na entrega</p>
                </div>
            </div>
            <div class="form-actions">
                <button id="btn-confirmar-pagamento" class="btn-primary">‚úÖ Confirmar e Gerar Pedido</button>
                <button id="btn-voltar-etapa" class="btn-secondary">‚Ü©Ô∏è Voltar</button>
            </div>
        </div>
    </div>

    <!-- Modal Confirma√ß√£o -->
    <div id="modalConfirmacao" class="modal">
        <div class="modal-content confirmacao-content">
            <div class="emoji-header">üçîüéâüöÄ</div>
            <h2>Pedido Confirmado! üõµ</h2>
            <div class="success-box">
                <p style="margin-bottom: 10px;">Obrigado, <strong id="nome-cliente-confirmacao" style="color: var(--laranja);"></strong>!</p>
                <p>Seu pedido foi enviado para a cozinha e j√° est√° sendo preparado com carinho! üë®‚Äçüç≥üî•</p>
            </div>
            <div class="info-box">
                <p><strong>üìã N¬∫ do Pedido:</strong> <span id="numero-pedido" style="font-weight: bold; color: var(--marrom);"></span></p>
                <p><strong>‚è± Tempo estimado:</strong> 40-50 minutos</p>
                <p><strong>üì± Voc√™ receber√°:</strong> Atualiza√ß√µes por WhatsApp</p>
            </div>
            <div class="codigo-entrega-container">
                <div class="codigo-entrega-label">üîë Seu C√≥digo de Entrega</div>
                <div id="codigo-entrega" class="codigo-entrega"></div>
                <small style="display: block; margin-top: 5px; color: #666;">Mostre este c√≥digo ao entregador</small>
            </div>
            <div style="margin-top: 25px; font-size: 14px; color: #666;">
                <p>üçü Seu lanche est√° a caminho! Agradecemos pela prefer√™ncia! ‚ù§Ô∏è</p>
            </div>
            <button id="btn-novo-pedido" class="btn-primary" style="margin-top: 20px;">
                üçî Fazer Novo Pedido
            </button>
        </div>
    </div>

    <script>
        const NOME_HAMBURGUERIA = "DokaBurger";
        const TAXA_ENTREGA = 5.00;
        const produtosContainer = document.querySelector('.produtos-container');
        const botoesCategoria = document.querySelectorAll('.categoria-btn');
        const contadorCarrinho = document.querySelector('.carrinho-contador');
        const modalCarrinho = document.getElementById('modalCarrinho');
        const modalLogin = document.getElementById('modalLogin');
        const modalEndereco = document.getElementById('modalEndereco');
        const modalPagamento = document.getElementById('modalPagamento');
        const modalConfirmacao = document.getElementById('modalConfirmacao');
        const modalConfirmarDados = document.getElementById('modalConfirmarDados');
        const carrinhoItensContainer = document.getElementById('carrinho-itens');
        const carrinhoSubtotal = document.getElementById('carrinho-subtotal');
        const carrinhoTaxaEntrega = document.getElementById('carrinho-taxa-entrega');
        const carrinhoTotalValor = document.getElementById('carrinho-total-valor');
        const btnNovoPedido = document.getElementById('btn-novo-pedido');
        let carrinho = [];
        let clienteAtual = null;
        let metodoPagamentoSelecionado = null;

        const cardapioDB = [
            // Burgers 180g
            { id: 'p1', nome: 'Doka Cheddar Bacon 180g', preco: 39.99, descricao: 'Hamb√∫rguer 180g, p√£o brioche, cheddar, bacon crocante e molho artesanal.', imagem: 'https://engeve89.github.io/imagenscardapio/foto/doka-cheddar-bacon-180g.avif ', categoria: 'Burgers 180g' },
            { id: 'p2', nome: 'Doka Duty', preco: 49.90, preco_antigo: 55.00, descricao: '2x Hamb√∫rgueres 180g, bacon em dobro, queijo prato, cebola caramelizada em dobro, alface/r√∫cula, tomate e molho.', imagem: 'https://engeve89.github.io/imagenscardapio/foto/doka%20duty.avif ', categoria: 'Burgers 180g' },
            { id: 'p3', nome: 'Big Doka', preco: 42.90, preco_antigo: 45.00, descricao: '2x Hamb√∫rgueres 120g, bacon em dobro, queijo prato, cebola caramelizada em dobro, alface/r√∫cula, tomate e molho.', imagem: 'https://images.unsplash.com/photo-1572802419224-296b0aeee0d9?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80', categoria: 'Burgers 180g' },
            { id: 'p4', nome: 'Doka Burguer 180g', preco: 36.90, descricao: 'Hamb√∫rguer 180g, p√£o brioche, queijo prato e molho artesanal.', imagem: ' https://engeve89.github.io/imagenscardapio/foto/doka-burguer-180g.avif ', categoria: 'Burgers 180g' },
            { id: 'p5', nome: 'doka cheese egg Bacon 180g', preco: 39.90, descricao: 'Hamb√∫rguer 180g, p√£o brioche, queijo prato, bacon e molho artesanal.', imagem: 'https://engeve89.github.io/imagenscardapio/foto/bell-cheese-egg-bacon.avif ', categoria: 'Burgers 180g' },
            { id: 'p6', nome: 'Doka Salada 180g', preco: 36.90, descricao: 'Hamb√∫rguer 180g, p√£o brioche, queijo prato, alface ou r√∫cula, tomate e molho artesanal.', imagem: 'https://engeve89.github.io/imagenscardapio/foto/bell-cheese-salada.avif ', categoria: 'Burgers 180g' },
            // Burgers 120g
            { id: 'b12_1', nome: 'Doka Burguer 120g', preco: 32.90, descricao: 'Hamb√∫rguer 120g, p√£o brioche, queijo prato e molho da casa.', imagem: 'https://engeve89.github.io/imagenscardapio/foto/cheese-burguer-doka.jpg ', categoria: 'Burgers 120g' },
            { id: 'b12_3', nome: 'Doka Bacon 120g', preco: 34.90, descricao: 'Hamb√∫rguer 120g, p√£o brioche, queijo prato, bacon e molho da casa.', imagem: 'https://engeve89.github.io/imagenscardapio/foto/doka-cheddar-bacon.avif ', categoria: 'Burgers 120g' },
            { id: 'b12_4', nome: 'Doka Salada 120g', preco: 32.90, descricao: 'Hamb√∫rguer 120g, p√£o brioche, queijo prato, alface ou r√∫cula, tomate e molho.', imagem: 'https://engeve89.github.io/imagenscardapio/foto/bell-cheese-salada.avif ', categoria: 'Burgers 120g' },
            { id: 'b12_5', nome: 'Dokinha cheese Bacon 120g', preco: 34.90, descricao: 'Hamb√∫rguer 120g, p√£o brioche, queijo prato, bacon e molho da casa.', imagem: 'https://engeve89.github.io/imagenscardapio/foto/smash-cheese-bacon.avif ', categoria: 'Burgers 120g' },
            { id: 'b12_9', nome: 'Doka Classic Burguer', preco: 28.90, descricao: "P√£o, 2 smash's 70g, 2 queijos cheddar, ketchup, mostarda, picles e cebola.", imagem: 'https://engeve89.github.io/imagenscardapio/foto/doka-classic-burguer.jpg ', categoria: 'Burgers 120g' },
            { id: 'b12_10', nome: 'Doka Triplo Cheesebacon', preco: 29.90, descricao: "P√£o, 3 smash's 70g, 3 queijos cheddar, bacon, ketchup e mostarda.", imagem: 'https://engeve89.github.io/imagenscardapio/foto/doka-triplo-cheesebacon.avif ', categoria: 'Burgers 120g' },
            { id: 'b12_11', nome: 'Triplo Cheesesalada', preco: 32.90, descricao: "P√£o, 3 smash's 70g, 3 queijos cheddar, alface, molho especial, picles e cebola.", imagem: 'https://engeve89.github.io/imagenscardapio/foto/triplo-cheesesalada.avif ', categoria: 'Burgers 120g' },
            // Frango
            { id: 'f2', nome: 'Doka Kids Chicken', preco: 29.90, descricao: 'P√£o de gergelim, frango empanado, maionese, tomate e alface picado.', imagem: 'https://engeve89.github.io/imagenscardapio/foto/doka-kids-chicken.avif ', categoria: 'Frango' },
            // Combos
            { id: 'c1', nome: 'Combo Dokinha 01', preco: 44.90, descricao: 'P√£o brioche, Hamb√∫rguer 150g, cheddar, molho especial + Fritas + Refri 350ml.', imagem: 'https://engeve89.github.io/imagenscardapio/foto/combo-dokinha01.avif ', categoria: 'Combos' },
            { id: 'c2', nome: 'Combo Dokinha Salada', preco: 48.60, descricao: 'P√£o brioche, Hamb√∫rguer 150g, cheddar, cebola roxa, picles, alface, tomate, maionese + Fritas + Refri 350ml.', imagem: 'https://engeve89.github.io/imagenscardapio/foto/combo-dokinha-salada.avif ', categoria: 'Combos' },
            { id: 'c3', nome: 'Combo Catubacon', preco: 54.99, descricao: 'P√£o brioche, Hamb√∫rguer 150g, Catupiry, bacon crocante, molho especial + Fritas + Refri 350ml.', imagem: 'https://engeve89.github.io/imagenscardapio/foto/combo-catubacon.jpg ', categoria: 'Combos' },
            { id: 'c4', nome: 'Combo Doka Casal Fit', preco: 69.99, descricao: '2x burguers cl√°ssicos (150g cada) + 2x Por√ß√µes de batata (aprox. 100g cada) + 2x refri lata.', imagem: 'https://engeve89.github.io/imagenscardapio/foto/combo-doka-casal-fit.avif ', categoria: 'Combos' },
            // Bebidas
            { id: 'b1', nome: 'Coca-Cola Original', preco: 7.50, descricao: 'Lata 350ml', imagem: 'https://engeve89.github.io/imagenscardapio/foto/coca-lata350ml.avif ', categoria: 'Bebidas' },
            { id: 'b2', nome: 'Coca-Cola 1L', preco: 12.00, descricao: 'Garrafa 1L', imagem: 'https://engeve89.github.io/imagenscardapio/foto/coca-cola-1litros.avif ', categoria: 'Bebidas' },
            { id: 'b3', nome: 'Guaran√° Fanta Laranja', preco: 7.50, descricao: 'Lata 350ml', imagem: 'https://engeve89.github.io/imagenscardapio/foto/refrigerante-guaran%C3%A1-fanta-laranja-350ml.avif ', categoria: 'Bebidas' },
            { id: 'b4', nome: 'Fanta Laranja', preco: 7.50, descricao: 'Lata 350ml', imagem: 'https://engeve89.github.io/imagenscardapio/foto/fanta-laranja-350ml.avif ', categoria: 'Bebidas' },
            { id: 'b5', nome: 'Fanta Uva', preco: 7.50, descricao: 'Lata 350ml', imagem: 'https://engeve89.github.io/imagenscardapio/foto/refrigerante-uva-fanta-350ml.avif ', categoria: 'Bebidas' },
            { id: 'b6', nome: 'Sprite Lim√£o Zero', preco: 7.50, descricao: 'Lata 350ml', imagem: 'https://engeve89.github.io/imagenscardapio/foto/sprite-lima-zero-350ml.avif ', categoria: 'Bebidas' },
            { id: 'b7', nome: 'Schweppes Citrus', preco: 8.00, descricao: 'Lata 350ml', imagem: 'https://engeve89.github.io/imagenscardapio/foto/refrigerante-schweppes-citrus-350ml.avif ', categoria: 'Bebidas' },
            { id: 'b8', nome: 'Ch√° Ice Tea Lim√£o', preco: 9.00, descricao: 'Garrafa 450ml', imagem: 'https://engeve89.github.io/imagenscardapio/foto/cha-ice-tea-leao-limao-450ml.avif ', categoria: 'Bebidas' }
        ];

        function carregarProdutos(categoriaSelecionada) {
            produtosContainer.innerHTML = '';
            const produtosFiltrados = cardapioDB.filter(p => p.categoria === categoriaSelecionada);
            produtosFiltrados.forEach(produto => {
                const card = document.createElement('div');
                card.className = 'produto-card';
                let precoHtml = `<div class="produto-preco">R$ ${produto.preco.toFixed(2).replace('.', ',')}</div>`;
                if (produto.preco_antigo) {
                    precoHtml = `<div class="produto-preco-container">
                                    <span class="produto-preco-antigo">R$ ${produto.preco_antigo.toFixed(2).replace('.', ',')}</span>
                                    <span class="produto-preco">R$ ${produto.preco.toFixed(2).replace('.', ',')}</span>
                                 </div>`;
                }
                card.innerHTML = `<div class="produto-imagem-container"><img src="${produto.imagem}" class="produto-imagem" alt="${produto.nome}"></div><div class="produto-conteudo"><div class="produto-nome">${produto.nome} ${produto.badge ? `<span class="produto-badge">${produto.badge}</span>` : ''}</div><div class="produto-descricao">${produto.descricao}</div><div class="produto-footer">${precoHtml}<button class="add-btn" data-id="${produto.id}">+</button></div></div>`;
                produtosContainer.appendChild(card);
            });
        }

        function adicionarAoCarrinho(id) {
            const produto = cardapioDB.find(p => p.id === id);
            const itemExistente = carrinho.find(item => item.id === id);
            if (itemExistente) {
                itemExistente.quantidade++;
            } else {
                carrinho.push({ ...produto, quantidade: 1, observacao: "" });
            }
            atualizarContadorCarrinho();
            atualizarModalCarrinho();
        }

        function removerDoCarrinho(id, removerTudo = false) {
            const itemIndex = carrinho.findIndex(item => item.id === id);
            if (itemIndex > -1) {
                if (removerTudo || carrinho[itemIndex].quantidade === 1) {
                    carrinho.splice(itemIndex, 1);
                } else {
                    carrinho[itemIndex].quantidade--;
                }
            }
            atualizarContadorCarrinho();
            atualizarModalCarrinho();
        }

        function atualizarContadorCarrinho() {
            contadorCarrinho.textContent = carrinho.reduce((total, item) => total + item.quantidade, 0);
        }

        function atualizarModalCarrinho() {
            carrinhoItensContainer.innerHTML = '';
            if (carrinho.length === 0) {
                carrinhoItensContainer.innerHTML = '<p style="text-align:center; color:#888;">Seu carrinho est√° vazio.</p>';
                document.getElementById('btn-finalizar-pedido').style.display = 'none';
                carrinhoSubtotal.textContent = "R$ 0,00";
                carrinhoTaxaEntrega.textContent = "R$ 5,00";
                carrinhoTotalValor.textContent = "R$ 0,00";
            } else {
                document.getElementById('btn-finalizar-pedido').style.display = 'block';
                let subtotal = 0;
                carrinho.forEach(item => {
                    subtotal += item.preco * item.quantidade;
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'carrinho-item';
                    itemDiv.innerHTML = `<div class="carrinho-item-header"><div class="carrinho-item-info"><strong>${item.nome}</strong><p>R$ ${item.preco.toFixed(2).replace('.', ',')}</p></div><div class="quantidade-controls"><button onclick="removerDoCarrinho('${item.id}')">-</button><span>${item.quantidade}</span><button onclick="adicionarAoCarrinho('${item.id}')">+</button></div><button class="remover-item-btn" onclick="removerDoCarrinho('${item.id}', true)"><i class="fas fa-trash"></i></button></div><div class="carrinho-item-obs"><input type="text" class="obs-input" data-id="${item.id}" placeholder="üìù Deseja adicionar alguma observa√ß√£o?" value="${item.observacao || ''}"></div>`;
                    carrinhoItensContainer.appendChild(itemDiv);
                });
                const total = subtotal + TAXA_ENTREGA;
                carrinhoSubtotal.textContent = `R$ ${subtotal.toFixed(2).replace('.', ',')}`;
                carrinhoTaxaEntrega.textContent = `R$ ${TAXA_ENTREGA.toFixed(2).replace('.', ',')}`;
                carrinhoTotalValor.textContent = `R$ ${total.toFixed(2).replace('.', ',')}`;
            }
        }

        function abrirModalCarrinho() {
            modalCarrinho.style.display = 'flex';
        }

        function fecharModalCarrinho() {
            modalCarrinho.style.display = 'none';
        }

        function abrirModalLogin() {
            fecharModalCarrinho();
            modalLogin.style.display = 'flex';
            document.getElementById('input-telefone').focus();
        }

        function fecharModalLogin() {
            modalLogin.style.display = 'none';
            abrirModalCarrinho();
        }

        function abrirModalEndereco() {
            fecharModalLogin();
            fecharModalConfirmarDados();
            modalEndereco.style.display = 'flex';
            document.getElementById('input-contato-endereco').value = clienteAtual.telefoneFormatado;
            document.getElementById('input-nome').focus();
        }

        function fecharModalEndereco() {
            modalEndereco.style.display = 'none';
        }

        function abrirModalPagamento() {
            fecharModalLogin();
            fecharModalEndereco();
            fecharModalConfirmarDados();
            modalPagamento.style.display = 'flex';
        }

        function fecharModalPagamento() {
            modalPagamento.style.display = 'none';
        }

        function abrirModalConfirmarDados(cliente) {
            fecharModalLogin();
            const dadosContainer = document.getElementById('dados-confirmacao');
            dadosContainer.innerHTML = `
                <p><strong>Nome:</strong> ${cliente.nome}</p>
                <p><strong>Endere√ßo:</strong> ${cliente.endereco}</p>
                ${cliente.referencia ? `<p><strong>Refer√™ncia:</strong> ${cliente.referencia}</p>` : ''}
            `;
            modalConfirmarDados.style.display = 'flex';
        }

        function fecharModalConfirmarDados() {
            modalConfirmarDados.style.display = 'none';
        }

        async function verificarTelefone() {
            const telefoneInput = document.getElementById('input-telefone');
            const telefoneCru = telefoneInput.value;
            const telefoneLimpo = telefoneCru.replace(/\D/g, '');
            if (telefoneLimpo.length < 10 || telefoneLimpo.length > 11) {
                alert("N√∫mero incorreto! Por favor, digite 10 ou 11 n√∫meros (DDD + Telefone).");
                return;
            }
            const btnContinuar = document.getElementById('btn-continuar-login');
            btnContinuar.disabled = true;
            btnContinuar.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verificando...';
            try {
                const response = await fetch('/api/identificar-cliente', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ telefone: telefoneCru })
                });
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    alert(errorData.message || "Ocorreu um erro no servidor.");
                    throw new Error(`Erro do Servidor: ${response.statusText}`);
                }
                const data = await response.json();
                if (data.success) {
                    clienteAtual = data.cliente;
                    clienteAtual.telefoneFormatado = telefoneCru;
                    if (data.isNew) {
                        abrirModalEndereco();
                    } else {
                        abrirModalConfirmarDados(clienteAtual);
                    }
                } else {
                    alert(data.message || "N√£o foi poss√≠vel validar seu n√∫mero. Tente novamente.");
                }
            } catch (error) {
                console.error("Erro de rede ao verificar telefone:", error);
                alert("N√£o foi poss√≠vel conectar ao nosso sistema. Verifique sua conex√£o e tente novamente.");
            } finally {
                btnContinuar.disabled = false;
                btnContinuar.textContent = 'Continuar';
            }
        }

        function salvarEndereco() {
            const nome = document.getElementById('input-nome').value.trim();
            const endereco = document.getElementById('input-endereco').value.trim();
            if (!nome || !endereco) {
                alert("Por favor, preencha Nome e Endere√ßo.");
                return;
            }
            clienteAtual.nome = nome;
            clienteAtual.endereco = endereco;
            clienteAtual.referencia = document.getElementById('input-referencia').value.trim();
            abrirModalPagamento();
        }

        function calcularTotalPedido() {
            const subtotal = carrinho.reduce((total, item) => total + (item.preco * item.quantidade), 0);
            return subtotal + TAXA_ENTREGA;
        }

        async function finalizarPedidoComPagamento() {
            if (!metodoPagamentoSelecionado) {
                alert("Por favor, selecione uma forma de pagamento.");
                return;
            }
            if (metodoPagamentoSelecionado === 'Dinheiro') {
                const trocoInput = document.getElementById('troco-input');
                const valorPedido = calcularTotalPedido();
                if (trocoInput.value && parseFloat(trocoInput.value) <= valorPedido) {
                    alert("O valor para troco deve ser maior que o total do pedido!");
                    return;
                }
            }
            const btnConfirmar = document.getElementById('btn-confirmar-pagamento');
            btnConfirmar.disabled = true;
            btnConfirmar.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Enviando...';
            const dadosDoPedido = {
                carrinho: carrinho,
                cliente: clienteAtual,
                pagamento: metodoPagamentoSelecionado,
                troco: metodoPagamentoSelecionado === 'Dinheiro' ? document.getElementById('troco-input').value || null : null
            };
            try {
                const response = await fetch('/api/criar-pedido', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(dadosDoPedido)
                });
                const result = await response.json();
                if (result.success) {
                    const numeroPedido = `WEB-${Math.floor(1000 + Math.random() * 9000)}`;
                    const codigoEntrega = clienteAtual.telefone.slice(-4);
                    document.getElementById('nome-cliente-confirmacao').textContent = clienteAtual.nome.split(' ')[0];
                    document.getElementById('numero-pedido').textContent = numeroPedido;
                    document.getElementById('codigo-entrega').textContent = codigoEntrega;
                    fecharModalPagamento();
                    modalConfirmacao.style.display = 'flex';
                } else {
                    alert(`Erro ao enviar o pedido: ${result.message}`);
                }
            } catch (error) {
                console.error("Erro de rede:", error);
                alert("N√£o foi poss√≠vel conectar ao nosso servidor. Verifique sua conex√£o e tente novamente.");
            } finally {
                btnConfirmar.disabled = false;
                btnConfirmar.textContent = '‚úÖ Confirmar e Gerar Pedido';
            }
        }

        function fecharModalConfirmacao() {
            modalConfirmacao.style.display = 'none';
            carrinho = [];
            clienteAtual = null;
            metodoPagamentoSelecionado = null;
            document.querySelectorAll('.metodo-pagamento.ativo').forEach(m => m.classList.remove('ativo'));
            document.querySelector('.troco-container').style.display = 'none';
            document.getElementById('troco-input').value = '';
            document.getElementById('troco-calculado').style.display = 'none';
            document.getElementById('input-telefone').value = '';
            atualizarContadorCarrinho();
            atualizarModalCarrinho();
            carregarProdutos('Burgers 180g');
        }

        function inicializar() {
            carregarProdutos('Burgers 180g');
            atualizarContadorCarrinho();

            document.getElementById('troco-input').addEventListener('input', function () {
                const trocoInput = parseFloat(this.value);
                const valorPedido = calcularTotalPedido();
                const trocoCalculado = document.getElementById('troco-calculado');
                if (trocoInput && !isNaN(trocoInput)) {
                    if (trocoInput > valorPedido) {
                        const trocoValor = trocoInput - valorPedido;
                        document.getElementById('valor-troco-texto').textContent =
                            `Troco: R$ ${trocoValor.toFixed(2).replace('.', ',')}`;
                        trocoCalculado.style.display = 'block';
                    } else {
                        trocoCalculado.style.display = 'none';
                    }
                } else {
                    trocoCalculado.style.display = 'none';
                }
            });

            const menuCategorias = document.querySelector('.menu-categorias');
            document.getElementById('btn-scroll-left').addEventListener('click', () => {
                menuCategorias.scrollLeft -= 150;
            });
            document.getElementById('btn-scroll-right').addEventListener('click', () => {
                menuCategorias.scrollLeft += 150;
            });

            botoesCategoria.forEach(botao => {
                botao.addEventListener('click', () => {
                    botoesCategoria.forEach(btn => btn.classList.remove('ativo'));
                    botao.classList.add('ativo');
                    carregarProdutos(botao.dataset.categoria);
                });
            });

            produtosContainer.addEventListener('click', (event) => {
                const addBtn = event.target.closest('.add-btn');
                if (addBtn) {
                    adicionarAoCarrinho(addBtn.dataset.id);
                    addBtn.innerHTML = '<i class="fas fa-check"></i>';
                    addBtn.style.background = 'var(--verde)';
                    setTimeout(() => {
                        addBtn.innerHTML = '+';
                        addBtn.style.background = 'var(--laranja)';
                    }, 1000);
                }
            });

            document.querySelector('.carrinho-btn').addEventListener('click', () => {
                if (carrinho.length === 0) {
                    alert('Seu carrinho est√° vazio!');
                    return;
                }
                abrirModalCarrinho();
            });

            carrinhoItensContainer.addEventListener('input', (event) => {
                if (event.target.classList.contains('obs-input')) {
                    const itemId = event.target.dataset.id;
                    const observacaoText = event.target.value;
                    const itemNoCarrinho = carrinho.find(item => item.id === itemId);
                    if (itemNoCarrinho) {
                        itemNoCarrinho.observacao = observacaoText;
                    }
                }
            });

            document.getElementById('btn-finalizar-pedido').addEventListener('click', abrirModalLogin);
            document.getElementById('btn-continuar-login').addEventListener('click', verificarTelefone);
            document.getElementById('btn-salvar-endereco').addEventListener('click', salvarEndereco);
            document.getElementById('btn-confirmar-pagamento').addEventListener('click', finalizarPedidoComPagamento);
            document.getElementById('btn-voltar-etapa').onclick = () => {
                fecharModalPagamento();
                abrirModalLogin();
            };
            document.getElementById('btn-novo-pedido').addEventListener('click', fecharModalConfirmacao);

            document.querySelectorAll('.metodo-pagamento').forEach(metodo => {
                metodo.addEventListener('click', () => {
                    document.querySelectorAll('.metodo-pagamento.ativo').forEach(m => m.classList.remove('ativo'));
                    metodo.classList.add('ativo');
                    metodoPagamentoSelecionado = metodo.dataset.metodo;
                    const trocoContainer = document.querySelector('.troco-container');
                    if (metodoPagamentoSelecionado === 'Dinheiro') {
                        trocoContainer.style.display = 'block';
                        document.getElementById('troco-input').focus();
                    } else {
                        trocoContainer.style.display = 'none';
                        document.getElementById('troco-calculado').style.display = 'none';
                    }
                });
            });

            document.getElementById('btn-dados-corretos').addEventListener('click', abrirModalPagamento);
            document.getElementById('btn-editar-dados').addEventListener('click', () => {
                fecharModalConfirmarDados();
                abrirModalEndereco();
                document.getElementById('input-nome').value = clienteAtual.nome;
                document.getElementById('input-endereco').value = clienteAtual.endereco;
                document.getElementById('input-referencia').value = clienteAtual.referencia || '';
            });
        }

        inicializar();
    </script>
</body>
</html>
